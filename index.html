<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇòÎßåÏùò Ï∫òÎ¶∞Îçî & ÏùºÍ∏∞Ïû•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 50%, #a8dadc 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-left: 280px;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .view-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .view-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: white;
            color: #667eea;
        }

        .main-content {
            padding: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .month-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .month-nav:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .current-period {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .year-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .month-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .month-card h4 {
            text-align: center;
            margin-bottom: 10px;
            color: #667eea;
        }

        .mini-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .mini-day {
            padding: 5px;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            position: relative;
        }

        .mini-day.has-schedule {
            background: #e3f2fd;
            border-radius: 3px;
        }

        .mini-day.holiday {
            color: #ff6b6b;
            font-weight: bold;
        }

        .mini-day.today::after {
            content: '‚óè';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 6px;
            color: #ff6b6b;
        }

        .day-header {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .day-cell {
            background: white;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            transition: all 0.3s;
        }

        .day-cell:hover {
            background: #f0f4ff;
            z-index: 10;
        }

        .day-cell.other-month {
            color: #ccc;
            background: #f8f8f8;
        }

        .day-cell.today {
            background: #ff6b6b;
            color: white;
            font-weight: bold;
            position: relative;
        }

        .day-cell.today .today-character {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            z-index: 1;
            animation: bounce 2s ease-in-out infinite;
        }

        .day-cell.today .day-number {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 2;
        }

        .day-cell.weekend {
            color: #ff6b6b;
        }

        .day-cell.holiday {
            color: #ff6b6b;
            font-weight: bold;
        }

        .day-cell.custom-color {
            border: 3px solid;
        }

        .day-cell.has-schedule::after {
            content: '‚óè';
            color: #4caf50;
            position: absolute;
            bottom: 5px;
            font-size: 12px;
        }

        .schedule-preview {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .schedule-bar {
            position: absolute;
            left: 0;
            right: 0;
            height: 4px;
            bottom: 0;
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 10000;
            max-width: 250px;
            pointer-events: none;
            display: none;
            white-space: normal;
            word-wrap: break-word;
        }

        .schedule-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .panel-title {
            font-size: 1.3em;
            color: #333;
            font-weight: bold;
        }

        .panel-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #5a6fd8;
        }

        .edit-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .edit-btn:hover {
            background: #45a049;
        }

        .schedule-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .schedule-item {
            background: #f8f9ff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }

        .schedule-item:hover {
            background: #e8ecff;
            transform: translateX(5px);
        }

        .schedule-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            border-left-color: #4caf50;
        }

        .schedule-time {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .schedule-content {
            color: #333;
        }

        .empty-schedule {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-title {
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }

        .close-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: #ff5252;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.3);
        }

        .time-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }

        .time-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .schedule-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .schedule-table {
            width: 100%;
            margin-top: 20px;
        }

        .schedule-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 8px;
        }

        .schedule-row input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .schedule-row input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-schedule-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .add-schedule-btn:hover {
            background: #45a049;
        }

        .diary-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
        }

        .diary-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.3);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .color-picker {
            width: 50px;
            height: 35px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .record-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .record-item {
            background: #e8f5e9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
        }

        .record-date {
            color: #4caf50;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .undo-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .undo-btn:hover {
            background: #f57c00;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translate(-50%, -50%) translateY(0px);
            }
            50% {
                transform: translate(-50%, -50%) translateY(-5px);
            }
        }

        /* Í≤åÏûÑÌôî ÏãúÏä§ÌÖú - ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î */
        .game-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            padding: 20px;
            overflow-y: auto;
            z-index: 999;
            border-right: 3px solid #667eea;
        }

        .game-sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .game-sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .game-sidebar::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .character-section {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .character-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .level-info {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .xp-info {
            font-size: 14px;
            color: #666;
        }

        .xp-bar-container {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, #7bed9f 0%, #2ed573 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .xp-bar-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #333;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .quest-section {
            margin-bottom: 25px;
        }

        .quest-section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quest-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid;
        }

        .quest-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .quest-item.normal {
            border-left-color: #74b9ff;
        }

        .quest-item.important {
            border-left-color: #ff9800;
        }

        .quest-item.urgent {
            border-left-color: #ff4757;
        }

        .quest-item.urgent .quest-xp {
            background: #ff4757;
        }

        .goal-section {
            margin-bottom: 25px;
        }

        .goal-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ff9800;
            transition: all 0.3s ease;
        }

        .goal-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            flex: 1;
        }

        .goal-progress-container {
            width: 100%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .goal-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff9800, #ff6b00);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .goal-stats {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }

        .delete-goal-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .delete-goal-btn:hover {
            background: #ff5252;
        }

        .quest-item.completed {
            border-left-color: #999;
            background: #f5f5f5;
            opacity: 0.7;
        }

        .quest-item.completed .quest-title {
            text-decoration: line-through;
        }

        .quest-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .quest-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .quest-title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            flex: 1;
        }

        .quest-xp {
            font-size: 12px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
        }

        .quest-item.normal .quest-xp {
            background: #74b9ff;
        }

        .quest-item.important .quest-xp {
            background: #ff9800;
        }

        .quest-item.completed .quest-xp {
            background: #999;
        }

        .quest-description {
            font-size: 12px;
            color: #666;
            margin-left: 26px;
        }

        .add-quest-btn {
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-quest-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .level-badges {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .mini-badge {
            font-size: 20px;
            cursor: pointer;
            filter: grayscale(100%);
            opacity: 0.3;
            transition: all 0.3s ease;
            position: relative;
        }

        .mini-badge.unlocked {
            filter: grayscale(0%);
            opacity: 1;
            animation: badgePulse 2s ease-in-out infinite;
        }

        .mini-badge:hover {
            transform: scale(1.3);
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .badge-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            margin-bottom: 5px;
        }

        .mini-badge:hover .badge-tooltip {
            opacity: 1;
        }

        .weekly-quest-section {
            margin-bottom: 25px;
        }

        .weekly-quest-item {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(108, 92, 231, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            color: white;
        }

        .weekly-quest-item:hover {
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 4px 12px rgba(108, 92, 231, 0.5);
        }

        .weekly-quest-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .weekly-quest-title {
            font-size: 14px;
            font-weight: bold;
            flex: 1;
        }

        .weekly-quest-xp {
            font-size: 12px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.3);
        }

        .weekly-quest-period {
            font-size: 11px;
            opacity: 0.9;
            margin-left: 26px;
        }

        .edit-schedule-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            margin-top: 10px;
            width: 100%;
        }

        .edit-schedule-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .badge-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .badge-item:hover {
            transform: scale(1.1);
        }

        .badge-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .badge-name {
            font-size: 10px;
            color: #666;
        }

        .badge-item.locked {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        .diary-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .diary-modal.active {
            display: flex;
        }

        .diary-modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 70vh;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        }

        .diary-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .diary-modal-title {
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }

        .diary-save-info {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
            text-align: right;
        }

        .adventure-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .adventure-btn {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .adventure-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .adventure-btn.records {
            background: linear-gradient(135deg, #4caf50, #45a049);
        }

        .adventure-btn.records:hover {
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        .all-schedules-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9998;
            justify-content: center;
            align-items: center;
        }

        .all-schedules-modal.active {
            display: flex;
        }

        .all-schedules-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        }

        .schedule-date-group {
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .schedule-date-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 16px;
        }

        .schedule-date-items {
            background: white;
        }

        .schedule-date-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .schedule-date-item:last-child {
            border-bottom: none;
        }

        .schedule-date-item:hover {
            background: #f8f9ff;
        }

        .schedule-date-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }

        .schedule-date-item .time {
            color: #667eea;
            font-weight: bold;
            min-width: 80px;
            margin-right: 15px;
        }

        .schedule-date-item .content {
            flex: 1;
            color: #333;
        }

        .schedule-date-item .priority-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }

        .priority-badge.normal {
            background: #74b9ff;
        }

        .priority-badge.important {
            background: #ff9800;
        }

        .priority-badge.urgent {
            background: #ff4757;
        }

        .weekly-quest-form {
            margin-top: 15px;
        }

        .weekly-quest-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .weekly-quest-edit-item {
            background: #f8f9ff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #a29bfe;
        }

        .weekly-quest-edit-header {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .weekly-quest-edit-dates {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .weekly-quest-edit-dates input {
            flex: 1;
        }

        @media (max-width: 1024px) {
            .game-sidebar {
                width: 250px;
            }
            .container {
                margin-left: 250px;
            }
        }

        @media (max-width: 768px) {
            .game-sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 3px solid #667eea;
            }
            .container {
                margin-left: 0;
            }
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes popOut {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }

        @keyframes levelUpPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            25% { transform: translate(-50%, -50%) scale(1.1); }
            50% { transform: translate(-50%, -50%) scale(0.95); }
            75% { transform: translate(-50%, -50%) scale(1.05); }
        }

        @keyframes badgeUnlock {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(180deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 1; }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìÖ ÎÇòÎßåÏùò Ï∫òÎ¶∞Îçî & ÏùºÍ∏∞Ïû•</h1>
            <p>ÏÜåÏ§ëÌïú ÌïòÎ£®Î•º Í∏∞Î°ùÌïòÍ≥† Í≥ÑÌöçÌï¥Î≥¥ÏÑ∏Ïöî</p>
            <div class="view-controls">
                <button class="view-btn active" onclick="changeView('month')">ÏõîÍ∞Ñ</button>
                <button class="view-btn" onclick="changeView('year')">Ïó∞Í∞Ñ</button>
            </div>
        </div>

        <div class="main-content">
            <div class="calendar-header">
                <button class="month-nav" onclick="changePeriod(-1)">‚Üê Ïù¥Ï†Ñ</button>
                <div class="current-period" id="currentPeriod">2025ÎÖÑ 10Ïõî</div>
                <button class="month-nav" onclick="changePeriod(1)">Îã§Ïùå ‚Üí</button>
            </div>

            <div id="monthView">
                <div class="calendar-grid" id="calendarGrid">
                    <div class="day-header">Ïùº</div>
                    <div class="day-header">Ïõî</div>
                    <div class="day-header">Ìôî</div>
                    <div class="day-header">Ïàò</div>
                    <div class="day-header">Î™©</div>
                    <div class="day-header">Í∏à</div>
                    <div class="day-header">ÌÜ†</div>
                </div>
            </div>

            <div id="yearView" style="display: none;">
                <div class="year-grid" id="yearGrid"></div>
            </div>

            <div class="schedule-panel">
                <div class="panel-header">
                    <div class="panel-title" id="panelDate">Ïò§ÎäòÏùò ÏùºÏ†ï</div>
                    <div class="panel-nav">
                        <button class="nav-btn" onclick="changePanelDate(-1)">‚óÄ Ïù¥Ï†Ñ</button>
                        <button class="nav-btn" onclick="changePanelDate(1)">Îã§Ïùå ‚ñ∂</button>
                    </div>
                </div>
                <div class="schedule-list" id="scheduleList"></div>
            </div>

            <div class="adventure-buttons">
                <button class="adventure-btn records" onclick="openAdventureRecords()">
                    üìú Î™®ÌóòÏùò Í∏∞Î°ù
                </button>
                <button class="adventure-btn" onclick="openAllSchedules()">
                    üìã Î™®Îì† ÏùºÏ†ï Î≥¥Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- Ìé∏Ïßë Î™®Îã¨ -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">ÏùºÏ†ï Ìé∏Ïßë</div>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>

            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('schedule')">ÏùºÏ†ï</button>
                <button class="tab-btn" onclick="switchTab('diary')">ÏùºÍ∏∞</button>
                <button class="tab-btn" onclick="switchTab('weekly')">Ï£ºÍ∞ÑÌÄòÏä§Ìä∏</button>
                <button class="tab-btn" onclick="switchTab('settings')">ÏÑ§Ï†ï</button>
            </div>

            <div id="scheduleTab" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">ÏùºÏ†ï Î™©Î°ù</label>
                    <div id="scheduleEditList"></div>
                    <button class="add-schedule-btn" onclick="addScheduleInModal()">+ ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä</button>
                </div>
            </div>

            <div id="diaryTab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">Ïò§ÎäòÏùò ÏùºÍ∏∞</label>
                    <textarea class="diary-textarea" id="diaryTextarea" placeholder="Ïò§Îäò ÌïòÎ£®Îäî Ïñ¥Îï†ÎÇòÏöî?"></textarea>
                </div>
            </div>

            <div id="weeklyTab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">Ï£ºÍ∞Ñ ÌÄòÏä§Ìä∏ Î™©Î°ù</label>
                    <div class="weekly-quest-list" id="weeklyQuestEditList"></div>
                    <button class="add-quest-btn" onclick="addWeeklyQuestInModal()">+ ÏÉà Ï£ºÍ∞ÑÌÄòÏä§Ìä∏ Ï∂îÍ∞Ä</button>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">ÎÇ†Ïßú ÏÉâÏÉÅ ÏÑ§Ï†ï</label>
                    <div class="checkbox-item">
                        <input type="checkbox" id="customColorCheck" onchange="toggleCustomColor()">
                        <label>ÌäπÎ≥ÑÌïú ÎÇ†Î°ú ÌëúÏãú</label>
                        <input type="color" id="customColorPicker" class="color-picker" value="#FFD700" disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ïû•Í∏∞ ÏùºÏ†ï ÏÑ§Ï†ï</label>
                    <div class="form-row">
                        <input type="date" id="rangeStartDate" class="form-input" placeholder="ÏãúÏûëÏùº">
                        <input type="date" id="rangeEndDate" class="form-input" placeholder="Ï¢ÖÎ£åÏùº">
                    </div>
                    <input type="text" id="rangeTitle" class="form-input" placeholder="ÏùºÏ†ï Ï†úÎ™© (Ïòà: Ï†úÏ£ºÎèÑ Ïó¨Ìñâ)" style="margin-top: 10px;">
                    <button class="btn-primary" onclick="saveRangeSchedule()" style="width: 100%; margin-top: 10px;">Ïû•Í∏∞ ÏùºÏ†ï Ï†ÄÏû•</button>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-secondary" onclick="closeModal()">Ï∑®ÏÜå</button>
                <button class="btn-primary" onclick="saveModalData()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Ìà¥ÌåÅ -->
    <div class="tooltip" id="tooltip"></div>

    <!-- ÏùºÍ∏∞ Î™®Îã¨ -->
    <div class="diary-modal" id="diaryModal">
        <div class="diary-modal-content">
            <div class="diary-modal-header">
                <div class="diary-modal-title" id="diaryModalTitle">üìù Ïò§ÎäòÏùò ÏùºÍ∏∞</div>
                <button class="close-btn" onclick="closeDiaryModal()">‚úï</button>
            </div>
            <textarea class="diary-textarea" id="diaryModalTextarea" placeholder="Ïò§Îäò ÌïòÎ£®Îäî Ïñ¥Îï†ÎÇòÏöî? ÏÜåÏ§ëÌïú ÏàúÍ∞ÑÎì§ÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî...

üí° Tip: Shift+EnterÎ°ú Ï§ÑÎ∞îÍøà, EnterÎ°ú Ï†ÄÏû•!"></textarea>
            <div class="diary-save-info">üíæ ÏûêÎèô Ï†ÄÏû•Îê©ÎãàÎã§</div>
        </div>
    </div>

    <!-- Î™®Îì† ÏùºÏ†ï Î≥¥Í∏∞ Î™®Îã¨ -->
    <div class="all-schedules-modal" id="allSchedulesModal">
        <div class="all-schedules-content">
            <div class="modal-header">
                <div class="modal-title">üìã Î™®Îì† ÏùºÏ†ï Î≥¥Í∏∞</div>
                <button class="close-btn" onclick="closeAllSchedulesModal()">‚úï</button>
            </div>
            <div id="allSchedulesList"></div>
        </div>
    </div>

    <!-- Î™®ÌóòÏùò Í∏∞Î°ù Î™®Îã¨ -->
    <div class="all-schedules-modal" id="adventureRecordsModal">
        <div class="all-schedules-content">
            <div class="modal-header">
                <div class="modal-title">üìú Î™®ÌóòÏùò Í∏∞Î°ù</div>
                <button class="close-btn" onclick="closeAdventureRecordsModal()">‚úï</button>
            </div>
            <div id="adventureRecordsList"></div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let currentView = 'month';
        let panelDate = new Date();
        let selectedDate = null;
        let scheduleData = {};
        let diaryData = {};
        let recordData = {};
        let customColors = {};
        let rangeSchedules = [];

        const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];

        const holidays = {
            '2025': [
                { date: '2025-1-1', name: 'Ïã†Ï†ï' },
                { date: '2025-1-28', name: 'ÏÑ§ÎÇ†' },
                { date: '2025-1-29', name: 'ÏÑ§ÎÇ†' },
                { date: '2025-1-30', name: 'ÏÑ§ÎÇ†' },
                { date: '2025-3-1', name: 'ÏÇºÏùºÏ†à' },
                { date: '2025-3-3', name: 'ÏÇºÏùºÏ†à ÎåÄÏ≤¥Ìú¥Ïùº' },
                { date: '2025-5-5', name: 'Ïñ¥Î¶∞Ïù¥ÎÇ†/Î∂ÄÏ≤òÎãòÏò§Ïã†ÎÇ†' },
                { date: '2025-5-6', name: 'ÎåÄÏ≤¥Ìú¥Ïùº' },
                { date: '2025-6-6', name: 'ÌòÑÏ∂©Ïùº' },
                { date: '2025-8-15', name: 'Í¥ëÎ≥µÏ†à' },
                { date: '2025-10-3', name: 'Í∞úÏ≤úÏ†à' },
                { date: '2025-10-5', name: 'Ï∂îÏÑù' },
                { date: '2025-10-6', name: 'Ï∂îÏÑù' },
                { date: '2025-10-7', name: 'Ï∂îÏÑù' },
                { date: '2025-10-8', name: 'Ï∂îÏÑù ÎåÄÏ≤¥Ìú¥Ïùº' },
                { date: '2025-10-9', name: 'ÌïúÍ∏ÄÎÇ†' },
                { date: '2025-12-25', name: 'ÌÅ¨Î¶¨Ïä§ÎßàÏä§' }
            ]
        };

        function isHoliday(year, month, day) {
            const dateStr = `${year}-${month + 1}-${day}`;
            const yearHolidays = holidays[year] || [];
            return yearHolidays.find(h => h.date === dateStr);
        }

        let gameData = {
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            goals: [],
            weeklyQuests: [],
            badges: [
                { id: 1, name: 'ÏãúÏûë', icon: 'üå±', unlocked: true },
                { id: 2, name: 'Ïó¥Ï†ï', icon: 'üî•', unlocked: false },
                { id: 3, name: 'Îã¨Ïù∏', icon: '‚≠ê', unlocked: false },
                { id: 4, name: 'Ï†ÑÏÑ§', icon: 'üëë', unlocked: false },
                { id: 5, name: 'ÏôÑÎ≤Ω', icon: 'üíé', unlocked: false },
                { id: 6, name: 'Î∂àÏÇ¨Ï°∞', icon: 'ü¶Ö', unlocked: false }
            ],
            consecutiveDays: 0,
            lastLoginDate: null
        };

        window.onload = function () {
            loadData();
            initGameSystem();
            updateCalendar();
            updateSchedulePanel();
        };

        function loadData() {
            const saved = localStorage.getItem('calendarData');
            if (saved) {
                const data = JSON.parse(saved);
                scheduleData = data.scheduleData || {};
                diaryData = data.diaryData || {};
                recordData = data.recordData || {};
                customColors = data.customColors || {};
                rangeSchedules = data.rangeSchedules || [];
            }
        }

        function saveData() {
            localStorage.setItem('calendarData', JSON.stringify({
                scheduleData,
                diaryData,
                recordData,
                customColors,
                rangeSchedules
            }));
        }

        function loadGameData() {
            const saved = localStorage.getItem('gameData');
            if (saved) {
                const savedData = JSON.parse(saved);
                gameData = { ...gameData, ...savedData };
            }
        }

        function saveGameData() {
            localStorage.setItem('gameData', JSON.stringify(gameData));
        }

        function initGameSystem() {
            loadGameData();
            checkConsecutiveLogin();
            createGameSidebar();
            updateGameUI();
        }

        function checkConsecutiveLogin() {
            const today = new Date().toDateString();
            const lastLogin = gameData.lastLoginDate;

            if (lastLogin !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);

                if (lastLogin === yesterday.toDateString()) {
                    gameData.consecutiveDays++;
                } else if (lastLogin !== null) {
                    gameData.consecutiveDays = 1;
                } else {
                    gameData.consecutiveDays = 1;
                }

                gameData.lastLoginDate = today;
                saveGameData();
            }
        }

        function createGameSidebar() {
            const sidebar = document.createElement('div');
            sidebar.className = 'game-sidebar';
            sidebar.id = 'gameSidebar';

            sidebar.innerHTML = `
                <div class="character-section">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='80'%3Eüßë%3C/text%3E%3C/svg%3E" alt="Ï∫êÎ¶≠ÌÑ∞" class="character-image" onclick="characterClick()">
                    <div class="level-info">
                        Î†àÎ≤® <span id="playerLevel">1</span>
                    </div>
                    <div class="level-badges" id="levelBadges"></div>
                    <div class="xp-info"><span id="currentXP">0</span> / <span id="maxXP">100</span> XP</div>
                    <div class="xp-bar-container">
                        <div class="xp-bar" id="xpBar" style="width: 0%"></div>
                        <div class="xp-bar-text" id="xpBarText">0%</div>
                    </div>
                </div>
                
                <div class="quest-section">
                    <div class="quest-section-title">
                        üìã Ïò§ÎäòÏùò ÏÉùÏÑ±Îêú ÌÄòÏä§Ìä∏
                    </div>
                    <div id="scheduleQuestList"></div>
                    <button class="edit-schedule-btn" onclick="editTodaySchedule()">‚úèÔ∏è ÏùºÏ†ï Ìé∏Ïßë</button>
                </div>
        
                <div class="weekly-quest-section">
                    <div class="quest-section-title">
                        üìÖ ÏùºÏùº ÌÄòÏä§Ìä∏
                    </div>
                    <div id="weeklyQuestList"></div>
                    <button class="add-quest-btn" onclick="addWeeklyQuest()">+ ÏùºÏùº ÌÄòÏä§Ìä∏ Ï∂îÍ∞Ä</button>
                </div>
        
                <div class="goal-section">
                    <div class="quest-section-title">
                        üéØ Î™©Ìëú (Ï§ëÏöî ÌÄòÏä§Ìä∏)
                    </div>
                    <div id="goalList"></div>
                    <button class="add-quest-btn" onclick="addNewGoal()">+ ÏÉà Î™©Ìëú Ï∂îÍ∞Ä</button>
                </div>
            `;

            document.body.insertBefore(sidebar, document.body.firstChild);
        }

        function updateGameUI() {
            document.getElementById('playerLevel').textContent = gameData.level;
            document.getElementById('currentXP').textContent = gameData.xp;
            document.getElementById('maxXP').textContent = gameData.xpToNextLevel;

            const xpPercent = (gameData.xp / gameData.xpToNextLevel) * 100;
            document.getElementById('xpBar').style.width = xpPercent + '%';
            document.getElementById('xpBarText').textContent = Math.floor(xpPercent) + '%';

            updateGoalList();
            updateMiniBadges();
            updateWeeklyQuestList();
            updateScheduleQuestList();
        }

        function updateMiniBadges() {
            const container = document.getElementById('levelBadges');
            container.innerHTML = '';

            gameData.badges.forEach(badge => {
                const badgeEl = document.createElement('span');
                badgeEl.className = `mini-badge ${badge.unlocked ? 'unlocked' : ''}`;
                badgeEl.innerHTML = `
                    ${badge.icon}
                    <span class="badge-tooltip">${badge.name}</span>
                `;
                container.appendChild(badgeEl);
            });
        }

        function updateWeeklyQuestList() {
            const container = document.getElementById('weeklyQuestList');

            if (!gameData.weeklyQuests || gameData.weeklyQuests.length === 0) {
                container.innerHTML = '<div class="empty-schedule" style="padding: 20px; text-align: center; color: #999; font-size: 12px;">Ï£ºÍ∞Ñ ÌÄòÏä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            container.innerHTML = '';

            gameData.weeklyQuests.forEach((quest, index) => {
                const questEl = document.createElement('div');
                questEl.className = 'weekly-quest-item';

                questEl.innerHTML = `
                    <div class="weekly-quest-header">
                        <input type="checkbox" class="quest-checkbox" 
                               onchange="completeWeeklyQuest(${index})"
                               style="accent-color: white;">
                        <div class="weekly-quest-title">${quest.title}</div>
                        <div class="weekly-quest-xp">+${quest.xp} XP</div>
                    </div>
                    <div class="weekly-quest-period">${quest.startDate} ~ ${quest.endDate}</div>
                `;

                container.appendChild(questEl);
            });
        }

        function addWeeklyQuest() {
            const title = prompt('ÏùºÏùº ÌÄòÏä§Ìä∏ Ï†úÎ™©:');
            if (!title) return;

            const startDate = prompt('ÏãúÏûëÏùº (Ïòà: 2025-12-01):');
            if (!startDate) return;

            const endDate = prompt('Ï¢ÖÎ£åÏùº (Ïòà: 2025-12-07):');
            if (!endDate) return;

            const baseXP = 60;
            const bonus = Math.floor(Math.random() * 11);
            const totalXP = baseXP + bonus;

            if (!gameData.weeklyQuests) gameData.weeklyQuests = [];
            gameData.weeklyQuests.push({
                id: Date.now(),
                title: title,
                startDate: startDate,
                endDate: endDate,
                xp: totalXP
            });

            saveGameData();
            updateGameUI();
        }

        function completeWeeklyQuest(index) {
            if (!gameData.weeklyQuests || !gameData.weeklyQuests[index]) return;

            const quest = gameData.weeklyQuests[index];

            if (confirm(`"${quest.title}" ÌÄòÏä§Ìä∏Î•º ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                gainXP(quest.xp);
                showXPGainAnimation(quest.xp);

                gameData.weeklyQuests.splice(index, 1);
                saveGameData();
                updateGameUI();
            } else {
                event.target.checked = false;
            }
        }

        function addWeeklyQuestInModal() {
            addWeeklyQuest();
            renderWeeklyQuestEditList();
        }

        function renderWeeklyQuestEditList() {
            const container = document.getElementById('weeklyQuestEditList');

            if (!gameData.weeklyQuests || gameData.weeklyQuests.length === 0) {
                container.innerHTML = '<div class="empty-schedule">Ï£ºÍ∞Ñ ÌÄòÏä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            container.innerHTML = '';

            gameData.weeklyQuests.forEach((quest, index) => {
                const item = document.createElement('div');
                item.className = 'weekly-quest-edit-item';

                item.innerHTML = `
                    <div class="weekly-quest-edit-header">
                        <input type="text" value="${quest.title}" class="form-input" 
                               onchange="updateWeeklyQuestField(${index}, 'title', this.value)"
                               placeholder="ÌÄòÏä§Ìä∏ Ï†úÎ™©">
                        <button class="btn-danger" onclick="deleteWeeklyQuest(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                    <div class="weekly-quest-edit-dates">
                        <input type="date" value="${quest.startDate}" class="form-input"
                               onchange="updateWeeklyQuestField(${index}, 'startDate', this.value)">
                        <input type="date" value="${quest.endDate}" class="form-input"
                               onchange="updateWeeklyQuestField(${index}, 'endDate', this.value)">
                    </div>
                    <div style="font-size: 12px; color: #666;">Î≥¥ÏÉÅ: ${quest.xp} XP</div>
                `;

                container.appendChild(item);
            });
        }

        function updateWeeklyQuestField(index, field, value) {
            if (gameData.weeklyQuests && gameData.weeklyQuests[index]) {
                gameData.weeklyQuests[index][field] = value;
                saveGameData();
            }
        }

        function deleteWeeklyQuest(index) {
            if (confirm('Ïù¥ Ï£ºÍ∞Ñ ÌÄòÏä§Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                gameData.weeklyQuests.splice(index, 1);
                saveGameData();
                renderWeeklyQuestEditList();
                updateGameUI();
            }
        }

        function updateScheduleQuestList() {
            const questList = document.getElementById('scheduleQuestList');
            const today = panelDate || new Date();
            const dateKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            const schedules = scheduleData[dateKey] || [];

            if (schedules.length === 0) {
                questList.innerHTML = '<div class="empty-schedule" style="padding: 20px; text-align: center; color: #999;">Ïò§Îäò ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            questList.innerHTML = '';

            schedules.forEach((schedule, index) => {
                const questItem = document.createElement('div');
                const priority = schedule.priority || 'normal';
                const xpAmount = priority === 'urgent' ? 25 : priority === 'important' ? 20 : 10;

                questItem.className = `quest-item ${priority} ${schedule.completed ? 'completed' : ''}`;

                questItem.innerHTML = `
                    <div class="quest-header">
                        <input type="checkbox" class="quest-checkbox" 
                               ${schedule.completed ? 'checked' : ''} 
                               onchange="toggleScheduleQuest('${dateKey}', ${index})">
                        <div class="quest-title">${schedule.content || 'Ï†úÎ™© ÏóÜÏùå'}</div>
                        <div class="quest-xp">+${xpAmount} XP</div>
                    </div>
                    <div class="quest-description">${schedule.time || 'ÏãúÍ∞Ñ ÎØ∏Ï†ï'}</div>
                `;

                questList.appendChild(questItem);
            });
        }

        function toggleScheduleQuest(dateKey, index) {
            if (!scheduleData[dateKey]) return;

            const schedule = scheduleData[dateKey][index];
            const priority = schedule.priority || 'normal';
            const xpAmount = priority === 'urgent' ? 25 : priority === 'important' ? 20 : 10;

            if (confirm('Ïù¥ ÏùºÏ†ïÏùÑ ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                gainXP(xpAmount);
                showXPGainAnimation(xpAmount);

                if (!recordData[dateKey]) recordData[dateKey] = [];
                recordData[dateKey].push(schedule);

                scheduleData[dateKey].splice(index, 1);
                if (scheduleData[dateKey].length === 0) delete scheduleData[dateKey];

                saveData();
                saveGameData();
                updateGameUI();
                updateCalendar();
                updateSchedulePanel();
            } else {
                event.target.checked = false;
            }
        }

        function updateGoalList() {
            const goalList = document.getElementById('goalList');

            if (gameData.goals.length === 0) {
                goalList.innerHTML = '<div class="empty-schedule" style="padding: 20px; text-align: center; color: #999;">Î™©ÌëúÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</div>';
                return;
            }

            goalList.innerHTML = '';

            gameData.goals.forEach((goal, index) => {
                const completedCount = goal.milestones.filter(m => m.completed).length;
                const totalCount = goal.milestones.length;
                const progressPercent = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;

                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';

                goalItem.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${goal.title}</div>
                        <button class="delete-goal-btn" onclick="deleteGoal(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                    <div class="goal-progress-container">
                        <div class="goal-progress" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="goal-stats">
                        <span>${completedCount} / ${totalCount} ÏôÑÎ£å</span>
                        <span>+${goal.totalXP} XP</span>
                    </div>
                `;

                goalItem.addEventListener('click', () => openGoalDetail(index));

                goalList.appendChild(goalItem);
            });
        }

        function addNewGoal() {
            const title = prompt('Î™©Ìëú Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (!title) return;

            const milestonesInput = prompt('ÎßàÏùºÏä§ÌÜ§ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ):\nÏòà: 1Îã®Í≥Ñ ÏôÑÎ£å, 2Îã®Í≥Ñ ÏôÑÎ£å, ÏµúÏ¢Ö ÏôÑÎ£å');
            if (!milestonesInput) return;

            const milestoneTexts = milestonesInput.split(',').map(m => m.trim()).filter(m => m);

            const newGoal = {
                id: Date.now(),
                title: title,
                milestones: milestoneTexts.map(text => ({
                    text: text,
                    completed: false,
                    xp: 30
                })),
                totalXP: milestoneTexts.length * 30,
                createdAt: new Date().toISOString()
            };

            gameData.goals.push(newGoal);
            saveGameData();
            updateGameUI();
        }

        function openGoalDetail(index) {
            const goal = gameData.goals[index];

            let milestoneHTML = goal.milestones.map((milestone, mIndex) => `
                <div style="padding: 10px; margin: 5px 0; background: ${milestone.completed ? '#e8f5e9' : '#f8f9ff'}; border-radius: 5px; display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" ${milestone.completed ? 'checked' : ''} 
                           onchange="toggleMilestone(${index}, ${mIndex})" 
                           style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="flex: 1; ${milestone.completed ? 'text-decoration: line-through; color: #999;' : ''}">${milestone.text}</span>
                    <span style="font-weight: bold; color: ${milestone.completed ? '#4caf50' : '#667eea'};">+${milestone.xp} XP</span>
                </div>
            `).join('');

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;

            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0;">
                        <h2 style="margin: 0; color: #333;">${goal.title}</h2>
                        <button onclick="this.closest('div[style*=\\"position: fixed\\"]').remove()" 
                                style="background: #ff6b6b; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px;">‚úï</button>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">
                            ÏßÑÌñâÎ•†: ${goal.milestones.filter(m => m.completed).length} / ${goal.milestones.length}
                        </div>
                        <div style="width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, #ff9800, #ff6b00); width: ${(goal.milestones.filter(m => m.completed).length / goal.milestones.length) * 100}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px; color: #333;">ÎßàÏùºÏä§ÌÜ§:</h3>
                        ${milestoneHTML}
                    </div>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            document.body.appendChild(modal);
        }

        function toggleMilestone(goalIndex, milestoneIndex) {
            const milestone = gameData.goals[goalIndex].milestones[milestoneIndex];

            if (!milestone.completed) {
                milestone.completed = true;
                gainXP(milestone.xp);
                showXPGainAnimation(milestone.xp);

                const goal = gameData.goals[goalIndex];
                const allCompleted = goal.milestones.every(m => m.completed);
                if (allCompleted) {
                    const bonusXP = 50;
                    gainXP(bonusXP);
                    setTimeout(() => {
                        showGoalCompleteAnimation(goal.title);
                    }, 1000);
                }
            } else {
                milestone.completed = false;
                gameData.xp = Math.max(0, gameData.xp - milestone.xp);
            }

            saveGameData();
            updateGameUI();

            document.querySelector('div[style*="position: fixed"]').remove();
            openGoalDetail(goalIndex);
        }

        function deleteGoal(index) {
            if (confirm('Ïù¥ Î™©ÌëúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                gameData.goals.splice(index, 1);
                saveGameData();
                updateGameUI();
            }
        }

        function showGoalCompleteAnimation(goalTitle) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #ff9800, #ff6b00);
                color: white;
                padding: 30px 50px;
                border-radius: 20px;
                font-size: 24px;
                font-weight: bold;
                z-index: 10001;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                text-align: center;
                animation: popIn 0.5s ease-out;
            `;
            notification.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 10px;">üéØ</div>
                Î™©Ìëú Îã¨ÏÑ±!<br>
                <div style="font-size: 18px; margin-top: 10px;">${goalTitle}</div>
                <div style="font-size: 20px; margin-top: 10px; color: #ffd700;">+50 Î≥¥ÎÑàÏä§ XP!</div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'popOut 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function gainXP(amount) {
            gameData.xp += amount;

            while (gameData.xp >= gameData.xpToNextLevel) {
                levelUp();
            }

            saveGameData();
            updateGameUI();
        }

        function levelUp() {
            gameData.xp -= gameData.xpToNextLevel;
            gameData.level++;
            gameData.xpToNextLevel = Math.floor(gameData.xpToNextLevel * 1.5);

            showLevelUpAnimation();
            checkBadgeUnlocks();
        }

        function showXPGainAnimation(xp) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #7bed9f, #2ed573);
                color: white;
                padding: 20px 40px;
                border-radius: 15px;
                font-size: 24px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: popIn 0.5s ease-out;
            `;
            notification.textContent = `+${xp} XP!`;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'popOut 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 1500);
        }

        function showLevelUpAnimation() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 30px 50px;
                border-radius: 20px;
                font-size: 32px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                animation: levelUpPulse 1s ease-out;
            `;
            notification.innerHTML = `
                üéâ Î†àÎ≤® ÏóÖ! üéâ<br>
                <span style="font-size: 48px;">Î†àÎ≤® ${gameData.level}</span>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'popOut 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        function checkBadgeUnlocks() {
            if (gameData.level >= 5 && !gameData.badges[1].unlocked) {
                gameData.badges[1].unlocked = true;
                showBadgeUnlock(gameData.badges[1]);
            }
            if (gameData.level >= 10 && !gameData.badges[2].unlocked) {
                gameData.badges[2].unlocked = true;
                showBadgeUnlock(gameData.badges[2]);
            }
            if (gameData.level >= 20 && !gameData.badges[3].unlocked) {
                gameData.badges[3].unlocked = true;
                showBadgeUnlock(gameData.badges[3]);
            }
        }

        function showBadgeUnlock(badge) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                color: #333;
                padding: 30px 50px;
                border-radius: 20px;
                font-size: 24px;
                font-weight: bold;
                z-index: 10000;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                text-align: center;
                animation: badgeUnlock 1s ease-out;
            `;
            notification.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 10px;">${badge.icon}</div>
                ÏÉà Î±ÉÏßÄ ÌöçÎìù!<br>
                "${badge.name}"
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'popOut 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 2500);
        }

        function editTodaySchedule() {
            const today = new Date();
            selectedDate = {
                year: today.getFullYear(),
                month: today.getMonth(),
                day: today.getDate()
            };
            openEditModal();
        }

        let characterClickCount = 0;
        function characterClick() {
            characterClickCount++;

            if (characterClickCount === 5) {
                showEasterEggMessage('üéâ 5Î≤à ÌÅ¥Î¶≠! +20 Î≥¥ÎÑàÏä§ XP!');
                gainXP(20);
                characterClickCount = 0;
            }
        }

        function showEasterEggMessage(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                color: #333;
                padding: 20px 40px;
                border-radius: 15px;
                font-size: 20px;
                font-weight: bold;
                z-index: 10001;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: popIn 0.5s ease-out;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'popOut 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        function changeView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (view === 'month') {
                document.getElementById('monthView').style.display = 'block';
                document.getElementById('yearView').style.display = 'none';
                updateCalendar();
            } else {
                document.getElementById('monthView').style.display = 'none';
                document.getElementById('yearView').style.display = 'block';
                updateYearView();
            }
        }

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            document.getElementById('currentPeriod').textContent = `${year}ÎÖÑ ${monthNames[month]}`;

            const grid = document.getElementById('calendarGrid');
            const existingCells = grid.querySelectorAll('.day-cell');
            existingCells.forEach(cell => cell.remove());

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDayOfWeek = firstDay.getDay();

            const prevMonth = month === 0 ? 11 : month - 1;
            const prevYear = month === 0 ? year - 1 : year;
            const prevMonthLastDay = new Date(prevYear, prevMonth + 1, 0).getDate();

            for (let i = startDayOfWeek - 1; i >= 0; i--) {
                const dayCell = createDayCell(prevMonthLastDay - i, true, prevYear, prevMonth);
                grid.appendChild(dayCell);
            }

            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = createDayCell(day, false, year, month);
                grid.appendChild(dayCell);
            }

            const totalCells = grid.children.length - 7;
            const remainingCells = 42 - totalCells;
            const nextMonth = month === 11 ? 0 : month + 1;
            const nextYear = month === 11 ? year + 1 : year;

            for (let day = 1; day <= remainingCells; day++) {
                const dayCell = createDayCell(day, true, nextYear, nextMonth);
                grid.appendChild(dayCell);
            }
        }

        function createDayCell(day, isOtherMonth, year, month) {
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            cell.textContent = day;
            const dateKey = `${year}-${month + 1}-${day}`;

            if (isOtherMonth) {
                cell.classList.add('other-month');
            }

            const today = new Date();
            const isToday = !isOtherMonth && year === today.getFullYear() &&
                month === today.getMonth() && day === today.getDate();

            if (isToday) {
                cell.classList.add('today');
                cell.textContent = '';

                const img = document.createElement('img');
                img.className = 'today-character';
                img.src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\'%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-size=\'30\'%3Eüßë%3C/text%3E%3C/svg%3E';
                img.alt = 'Ïò§Îäò';

                const dayNum = document.createElement('span');
                dayNum.className = 'day-number';
                dayNum.textContent = day;

                cell.appendChild(img);
                cell.appendChild(dayNum);
            }

            const date = new Date(year, month, day);
            const dayOfWeek = date.getDay();
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                cell.classList.add('weekend');
            }

            const holiday = isHoliday(year, month, day);
            if (holiday) {
                cell.classList.add('holiday');
                cell.title = holiday.name;
            }

            if (customColors[dateKey]) {
                cell.classList.add('custom-color');
                cell.style.borderColor = customColors[dateKey];
            }

            if (scheduleData[dateKey] && scheduleData[dateKey].length > 0) {
                cell.classList.add('has-schedule');
            }

            const rangeSchedule = rangeSchedules.find(rs => {
                const start = new Date(rs.start);
                const end = new Date(rs.end);
                const current = new Date(year, month, day);
                return current >= start && current <= end;
            });

            if (rangeSchedule) {
                const bar = document.createElement('div');
                bar.className = 'schedule-bar';
                bar.style.background = rangeSchedule.color || '#667eea';
                cell.appendChild(bar);
            }

            cell.addEventListener('click', () => {
                panelDate = new Date(year, month, day);
                updateSchedulePanel();
            });

            cell.addEventListener('dblclick', () => {
                selectedDate = { year, month, day };
                openEditModal();
            });

            cell.addEventListener('mouseenter', (e) => showTooltip(e, dateKey));
            cell.addEventListener('mouseleave', hideTooltip);

            return cell;
        }

        function showTooltip(e, dateKey) {
            const schedules = scheduleData[dateKey];
            if (!schedules || schedules.length === 0) return;

            const tooltip = document.getElementById('tooltip');
            let content = schedules.slice(0, 3).map(s => `${s.time || ''} ${s.content || ''}`).join('<br>');
            if (schedules.length > 3) content += '<br>...';

            tooltip.innerHTML = content;
            tooltip.style.display = 'block';
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        function updateYearView() {
            const year = currentDate.getFullYear();
            document.getElementById('currentPeriod').textContent = `${year}ÎÖÑ`;

            const yearGrid = document.getElementById('yearGrid');
            yearGrid.innerHTML = '';

            const today = new Date();
            const todayYear = today.getFullYear();
            const todayMonth = today.getMonth();
            const todayDay = today.getDate();

            for (let m = 0; m < 12; m++) {
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `<h4>${monthNames[m]}</h4>`;

                const miniCal = document.createElement('div');
                miniCal.className = 'mini-calendar';

                ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'].forEach(d => {
                    const header = document.createElement('div');
                    header.textContent = d;
                    header.style.fontWeight = 'bold';
                    header.style.fontSize = '10px';
                    miniCal.appendChild(header);
                });

                const firstDay = new Date(year, m, 1);
                const lastDay = new Date(year, m + 1, 0);
                const startDayOfWeek = firstDay.getDay();

                for (let i = 0; i < startDayOfWeek; i++) {
                    miniCal.appendChild(document.createElement('div'));
                }

                for (let d = 1; d <= lastDay.getDate(); d++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'mini-day';
                    dayDiv.textContent = d;

                    const dateKey = `${year}-${m + 1}-${d}`;
                    if (scheduleData[dateKey] && scheduleData[dateKey].length > 0) {
                        dayDiv.classList.add('has-schedule');
                    }

                    const holiday = isHoliday(year, m, d);
                    if (holiday) {
                        dayDiv.classList.add('holiday');
                        dayDiv.title = holiday.name;
                    }

                    if (year === todayYear && m === todayMonth && d === todayDay) {
                        dayDiv.classList.add('today');
                    }

                    dayDiv.addEventListener('click', () => {
                        currentDate = new Date(year, m, 1);
                        changeView('month');
                        document.querySelectorAll('.view-btn')[0].classList.add('active');
                        document.querySelectorAll('.view-btn')[1].classList.remove('active');
                        panelDate = new Date(year, m, d);
                        updateSchedulePanel();
                    });

                    miniCal.appendChild(dayDiv);
                }

                card.appendChild(miniCal);
                yearGrid.appendChild(card);
            }
        }

        function changePeriod(direction) {
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + direction);
                updateCalendar();
            } else {
                currentDate.setFullYear(currentDate.getFullYear() + direction);
                updateYearView();
            }
        }

        function changePanelDate(direction) {
            panelDate.setDate(panelDate.getDate() + direction);
            updateSchedulePanel();
            updateScheduleQuestList();
        }

        function updateSchedulePanel() {
            const year = panelDate.getFullYear();
            const month = panelDate.getMonth();
            const day = panelDate.getDate();
            const dateKey = `${year}-${month + 1}-${day}`;

            const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
            const dayName = dayNames[panelDate.getDay()];

            document.getElementById('panelDate').textContent = `${year}ÎÖÑ ${month + 1}Ïõî ${day}Ïùº (${dayName})`;

            const scheduleList = document.getElementById('scheduleList');
            const schedules = scheduleData[dateKey] || [];

            if (schedules.length === 0) {
                scheduleList.innerHTML = '<div class="empty-schedule">Îì±Î°ùÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            scheduleList.innerHTML = '';
            schedules.forEach((schedule, index) => {
                const item = document.createElement('div');
                item.className = 'schedule-item';
                if (schedule.completed) item.classList.add('completed');

                item.innerHTML = `
                    <div class="schedule-time">${schedule.time || 'ÏãúÍ∞Ñ ÎØ∏Ï†ï'}</div>
                    <div class="schedule-content">${schedule.content || 'ÎÇ¥Ïö© ÏóÜÏùå'}</div>
                `;

                item.addEventListener('dblclick', () => {
                    selectedDate = { year, month, day };
                    openEditModal();
                });

                scheduleList.appendChild(item);
            });
        }

        function openEditModal() {
            if (!selectedDate) {
                selectedDate = {
                    year: panelDate.getFullYear(),
                    month: panelDate.getMonth(),
                    day: panelDate.getDate()
                };
            }

            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            document.getElementById('modalTitle').textContent =
                `${selectedDate.year}ÎÖÑ ${selectedDate.month + 1}Ïõî ${selectedDate.day}Ïùº`;

            renderScheduleEditList();
            renderWeeklyQuestEditList();

            document.getElementById('diaryTextarea').value = diaryData[dateKey] || '';

            document.getElementById('customColorCheck').checked = !!customColors[dateKey];
            document.getElementById('customColorPicker').disabled = !customColors[dateKey];
            if (customColors[dateKey]) {
                document.getElementById('customColorPicker').value = customColors[dateKey];
            }

            document.getElementById('editModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            selectedDate = null;
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function renderScheduleEditList() {
            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            const schedules = scheduleData[dateKey] || [];
            const container = document.getElementById('scheduleEditList');

            container.innerHTML = '';
            schedules.forEach((schedule, index) => {
                const row = document.createElement('div');
                row.className = 'schedule-row';
                row.innerHTML = `
                    <input type="checkbox" class="schedule-checkbox" ${schedule.completed ? 'checked' : ''} 
                          onchange="toggleScheduleComplete(${index})">
                    <input type="text" value="${schedule.time || ''}" placeholder="00:00" 
                           class="time-input" maxlength="5"
                           onchange="updateScheduleField(${index}, 'time', this.value)"
                           onkeypress="handleTimeInput(event)"
                           onkeydown="handleEnterKey(event, ${index})">
                    <input type="text" value="${schedule.content || ''}" placeholder="ÏùºÏ†ï ÎÇ¥Ïö© ÏûÖÎ†•" 
                           onchange="updateScheduleField(${index}, 'content', this.value)"
                           onkeydown="handleEnterKey(event, ${index})" class="form-input">
                    <select onchange="updateScheduleField(${index}, 'priority', this.value)" 
                            style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">
                        <option value="normal" ${schedule.priority === 'normal' || !schedule.priority ? 'selected' : ''}>ÏùºÎ∞ò</option>
                        <option value="important" ${schedule.priority === 'important' ? 'selected' : ''}>Ï§ëÏöî</option>
                        <option value="urgent" ${schedule.priority === 'urgent' ? 'selected' : ''}>Í∏¥Í∏â</option>
                    </select>
                    <button class="btn-danger" onclick="deleteScheduleInModal(${index})">ÏÇ≠Ï†ú</button>
                `;
                container.appendChild(row);
            });
        }

        function handleTimeInput(e) {
            const char = e.key;
            const input = e.target;
            const value = input.value;

            if (!/[0-9:]/.test(char) && char !== 'Backspace') {
                e.preventDefault();
                return;
            }

            if (value.length === 2 && char !== ':' && char !== 'Backspace') {
                input.value = value + ':';
            }
        }

        function handleEnterKey(e, index) {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveModalData();
            }
        }

        function toggleScheduleComplete(index) {
            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            if (scheduleData[dateKey] && scheduleData[dateKey][index]) {
                const isChecked = event.target.checked;

                if (isChecked) {
                    if (confirm('Ïù¥ ÏùºÏ†ïÏùÑ ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        const schedule = scheduleData[dateKey][index];

                        if (!recordData[dateKey]) recordData[dateKey] = [];
                        recordData[dateKey].push(schedule);

                        scheduleData[dateKey].splice(index, 1);
                        if (scheduleData[dateKey].length === 0) delete scheduleData[dateKey];

                        saveData();
                        renderScheduleEditList();
                        updateCalendar();
                    } else {
                        event.target.checked = false;
                    }
                }
            }
        }

        function addScheduleInModal() {
            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            if (!scheduleData[dateKey]) scheduleData[dateKey] = [];
            scheduleData[dateKey].push({ time: '', content: '', completed: false });
            renderScheduleEditList();

            setTimeout(() => {
                const inputs = document.querySelectorAll('#scheduleEditList .time-input');
                if (inputs.length > 0) {
                    inputs[inputs.length - 1].focus();
                }
            }, 100);
        }

        function updateScheduleField(index, field, value) {
            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            if (scheduleData[dateKey] && scheduleData[dateKey][index]) {
                scheduleData[dateKey][index][field] = value;
            }
        }

        function deleteScheduleInModal(index) {
            if (!confirm('Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;
            if (scheduleData[dateKey]) {
                scheduleData[dateKey].splice(index, 1);
                if (scheduleData[dateKey].length === 0) delete scheduleData[dateKey];
                saveData();
                renderScheduleEditList();
                updateCalendar();
                updateSchedulePanel();
            }
        }

        function toggleCustomColor() {
            const checked = document.getElementById('customColorCheck').checked;
            document.getElementById('customColorPicker').disabled = !checked;
        }

        function saveRangeSchedule() {
            const start = document.getElementById('rangeStartDate').value;
            const end = document.getElementById('rangeEndDate').value;
            const title = document.getElementById('rangeTitle').value;

            if (!start || !end || !title) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }

            const color = '#' + Math.floor(Math.random() * 16777215).toString(16);
            rangeSchedules.push({ start, end, title, color });

            document.getElementById('rangeStartDate').value = '';
            document.getElementById('rangeEndDate').value = '';
            document.getElementById('rangeTitle').value = '';

            saveData();
            updateCalendar();
            alert('Ïû•Í∏∞ ÏùºÏ†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        }

        function saveModalData() {
            const dateKey = `${selectedDate.year}-${selectedDate.month + 1}-${selectedDate.day}`;

            const diaryText = document.getElementById('diaryTextarea').value;
            if (diaryText.trim()) {
                diaryData[dateKey] = diaryText;
            } else {
                delete diaryData[dateKey];
            }

            const colorChecked = document.getElementById('customColorCheck').checked;
            if (colorChecked) {
                customColors[dateKey] = document.getElementById('customColorPicker').value;
            } else {
                delete customColors[dateKey];
            }

            saveData();
            updateCalendar();
            updateSchedulePanel();
            updateScheduleQuestList();

            alert('‚úÖ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        }

        let diaryModalDate = null;

        function openDiaryModal(year, month, day) {
            diaryModalDate = { year, month, day };
            const dateKey = `${year}-${month + 1}-${day}`;
            const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
            const date = new Date(year, month, day);
            const dayName = dayNames[date.getDay()];

            document.getElementById('diaryModalTitle').textContent =
                `üìù ${year}ÎÖÑ ${month + 1}Ïõî ${day}Ïùº (${dayName}) ÏùºÍ∏∞`;

            document.getElementById('diaryModalTextarea').value = diaryData[dateKey] || '';
            document.getElementById('diaryModal').classList.add('active');

            setTimeout(() => {
                document.getElementById('diaryModalTextarea').focus();
            }, 100);
        }

        function closeDiaryModal() {
            saveDiaryFromModal();
            document.getElementById('diaryModal').classList.remove('active');
            diaryModalDate = null;
        }

        function saveDiaryFromModal() {
            if (!diaryModalDate) return;

            const dateKey = `${diaryModalDate.year}-${diaryModalDate.month + 1}-${diaryModalDate.day}`;
            const text = document.getElementById('diaryModalTextarea').value;

            if (text.trim()) {
                diaryData[dateKey] = text;
            } else {
                delete diaryData[dateKey];
            }

            saveData();
        }

        document.addEventListener('DOMContentLoaded', function () {
            const diaryTextarea = document.getElementById('diaryModalTextarea');
            if (diaryTextarea) {
                diaryTextarea.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        closeDiaryModal();
                    }
                });
            }
        });

        function openAllSchedules() {
            const container = document.getElementById('allSchedulesList');
            container.innerHTML = '';

            const incompleteSchedules = {};
            Object.keys(scheduleData).forEach(dateKey => {
                const schedules = scheduleData[dateKey].filter(s => !s.completed && !s.questCompleted);
                if (schedules.length > 0) {
                    incompleteSchedules[dateKey] = schedules;
                }
            });

            const sortedDates = Object.keys(incompleteSchedules).sort();

            if (sortedDates.length === 0) {
                container.innerHTML = '<div class="empty-schedule">ÎØ∏ÏôÑÎ£åÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§! üéâ</div>';
            } else {
                sortedDates.forEach(dateKey => {
                    const [year, month, day] = dateKey.split('-').map(Number);
                    const date = new Date(year, month - 1, day);
                    const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
                    const dayName = dayNames[date.getDay()];

                    const group = document.createElement('div');
                    group.className = 'schedule-date-group';

                    let headerHTML = `
                        <div class="schedule-date-header">
                            üìÖ ${year}ÎÖÑ ${month}Ïõî ${day}Ïùº (${dayName})
                        </div>
                        <div class="schedule-date-items">
                    `;

                    incompleteSchedules[dateKey].forEach((schedule, index) => {
                        const priority = schedule.priority || 'normal';
                        const priorityText = priority === 'urgent' ? 'Í∏¥Í∏â' : priority === 'important' ? 'Ï§ëÏöî' : 'ÏùºÎ∞ò';

                        headerHTML += `
                            <div class="schedule-date-item">
                                <input type="checkbox" onchange="completeScheduleFromAll('${dateKey}', ${scheduleData[dateKey].indexOf(schedule)})">
                                <span class="time">${schedule.time || 'ÏãúÍ∞Ñ ÎØ∏Ï†ï'}</span>
                                <span class="content">${schedule.content || 'ÎÇ¥Ïö© ÏóÜÏùå'}</span>
                                <span class="priority-badge ${priority}">${priorityText}</span>
                            </div>
                        `;
                    });

                    headerHTML += '</div>';
                    group.innerHTML = headerHTML;
                    container.appendChild(group);
                });
            }

            document.getElementById('allSchedulesModal').classList.add('active');
        }

        function closeAllSchedulesModal() {
            document.getElementById('allSchedulesModal').classList.remove('active');
        }

        function completeScheduleFromAll(dateKey, index) {
            toggleScheduleQuest(dateKey, index);
            setTimeout(() => openAllSchedules(), 300);
        }

        function openAdventureRecords() {
            const container = document.getElementById('adventureRecordsList');
            updateAdventureRecordsContent(container);
            document.getElementById('adventureRecordsModal').classList.add('active');
        }

        function closeAdventureRecordsModal() {
            document.getElementById('adventureRecordsModal').classList.remove('active');
        }

        function updateAdventureRecordsContent(container) {
            const records = Object.entries(recordData).sort((a, b) => b[0].localeCompare(a[0]));

            if (records.length === 0) {
                container.innerHTML = '<div class="empty-schedule">ÏïÑÏßÅ ÏôÑÎ£åÌïú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            container.innerHTML = '';
            records.forEach(([dateKey, items]) => {
                const [year, month, day] = dateKey.split('-').map(Number);
                const date = new Date(year, month - 1, day);
                const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
                const dayName = dayNames[date.getDay()];

                const group = document.createElement('div');
                group.className = 'schedule-date-group';

                let html = `
                    <div class="schedule-date-header" style="background: linear-gradient(135deg, #4caf50, #45a049);">
                        ‚úÖ ${year}ÎÖÑ ${month}Ïõî ${day}Ïùº (${dayName})
                    </div>
                    <div class="schedule-date-items">
                `;

                items.forEach((item, index) => {
                    html += `
                        <div class="schedule-date-item">
                            <span class="time">${item.time || 'ÏãúÍ∞Ñ ÎØ∏Ï†ï'}</span>
                            <span class="content">${item.content || 'ÎÇ¥Ïö© ÏóÜÏùå'}</span>
                            <button class="undo-btn" onclick="undoScheduleFromAdventure('${dateKey}', ${index})">‚Ü© ÎêòÎèåÎ¶¨Í∏∞</button>
                        </div>
                    `;
                });

                html += '</div>';
                group.innerHTML = html;
                container.appendChild(group);
            });
        }

        function undoSchedule(dateKey, index) {
            if (!recordData[dateKey]) return;

            const schedule = recordData[dateKey][index];
            if (!scheduleData[dateKey]) scheduleData[dateKey] = [];
            scheduleData[dateKey].push(schedule);

            recordData[dateKey].splice(index, 1);
            if (recordData[dateKey].length === 0) delete recordData[dateKey];

            saveData();
            updateCalendar();
            updateSchedulePanel();
        }

        function undoScheduleFromAdventure(dateKey, index) {
            undoSchedule(dateKey, index);
            const container = document.getElementById('adventureRecordsList');
            updateAdventureRecordsContent(container);
        }
    </script>
</body>
</html>